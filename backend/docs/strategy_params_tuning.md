# 成交量策略参数调优指南

## 当前问题诊断

### 症状
- 边沿触发少（说明价格很少到达VAH/VAL附近）
- 边沿触发后，成交量条件过滤掉了大部分机会
- 转化率极低（边沿触发→实际信号）

### 3分钟K线特点分析

#### 时间跨度
- 720根 × 3分钟 = 2160分钟 = 36小时 = 1.5天
- 相比1分钟：更平滑，噪音较少
- 相比5分钟：更敏感，捕捉细节

#### 成交量特征
- 3分钟内成交量累积，波动比1分钟小
- 但比5分钟更容易出现局部爆发
- Z值（标准差倍数）应该相应调整

## 参数调整策略

### 原则
1. **降低阈值**：让更多边沿触发通过成交量验证
2. **保持质量**：不能过度放松导致假信号
3. **平衡风控**：通过止损止盈控制单笔风险

### 具体调整方案

#### 方案A：保守调整（推荐先测试）
```javascript
// 模块B参数
P1_WEIGHT: 0.25,              // 不变
P2_LOCAL_Z_THRESHOLD: 1.8,    // 降低：2.3 → 1.8
P2_WEIGHT: 0.20,              // 不变

P3_GLOBAL_Z_THRESHOLD: 1.5,   // 降低：2.0 → 1.5
P3_WEIGHT: 0.15,              // 不变

P4_VOLUME_RATIO: 1.6,         // 降低：2.0 → 1.6
P4_WEIGHT: 0.20,              // 不变

P5_MA5_RATIO: 1.5,            // 降低：1.8 → 1.5
P5_WEIGHT: 0.10,              // 不变

P6_DIST_STRENGTH: 1.2,        // 降低：1.3 → 1.2
P6_WEIGHT: 0.05,              // 不变

// 边沿检测
edgeThresholdPct: 0.05,       // 5%（当前值，合理）
```

**预期效果**：
- 边沿触发次数：不变
- 边沿→信号转化率：从 <1% 提升到 5-10%
- 交易次数：从个位数提升到 50-150 笔/2.5年

#### 方案B：激进调整（如果方案A仍然信号太少）
```javascript
P2_LOCAL_Z_THRESHOLD: 1.5,    // 1.8 → 1.5
P3_GLOBAL_Z_THRESHOLD: 1.2,   // 1.5 → 1.2
P4_VOLUME_RATIO: 1.4,         // 1.6 → 1.4
P5_MA5_RATIO: 1.3,            // 1.5 → 1.3
P6_DIST_STRENGTH: 1.0,        // 1.2 → 1.0
edgeThresholdPct: 0.07,       // 5% → 7%
```

**预期效果**：
- 交易次数：100-300 笔/2.5年
- 胜率可能下降，但样本量增加便于优化

#### 方案C：最小化过滤（用于摸清上限）
```javascript
// 几乎只保留P1（边沿检测）+ 任一其他条件
// 降低最低分数要求
minScoreB: 0.30,              // 从0.25提升到0.30，即P1 + 部分其他条件
```

## 实施步骤

### Step 1: 运行诊断模式
```bash
npm run backtest
```

查看日志中：
- 前10次边沿触发的详细信息
- 每个P2-P6条件的通过情况
- 典型的 zLocal, zGlobal, volumeRatio, ma5Ratio 数值

### Step 2: 分析诊断结果
记录典型数值：
```
P2: zLocal通常在 [X, Y] 范围
P3: zGlobal通常在 [X, Y] 范围
P4: volumeRatio通常在 [X, Y] 范围
P5: ma5Ratio通常在 [X, Y] 范围
```

### Step 3: 精确调整阈值
将阈值设置为"典型值的80分位"，这样能通过约20%的边沿触发。

### Step 4: 迭代优化
1. 测试参数 → 2. 查看结果 → 3. 调整参数 → 4. 重复

## 关键指标目标

### 合理范围
- **边沿触发率**：1-5%（即1000-5000次/86000个K线）
- **边沿→信号转化率**：5-20%
- **交易次数**：50-300笔/2.5年（平均3-30天一笔）
- **胜率**：35-55%（配合1:2盈亏比）
- **夏普比率**：> 1.0

### 警告信号
- 交易次数 < 30：参数太严格
- 交易次数 > 500：可能过拟合或过度交易
- 胜率 < 30%：策略逻辑有问题
- 最大回撤 > 20%：风险过高

## 附加建议

### 1. 分市场状态调参
不同市场环境可能需要不同参数：
- **牛市**：倾向做多，可以放松P4-P5（成交量爆发）
- **熊市**：倾向做空，可以放松边沿检测
- **震荡市**：严格条件，减少假突破

### 2. 考虑时间过滤
加入时间过滤器，只在高流动性时段交易：
- 亚洲早盘（UTC 0-8）：流动性差，可能跳过
- 欧美盘（UTC 13-22）：流动性好，正常交易

### 3. 增加确认条件
在模块C中增加：
- 价格动量确认
- 趋势方向确认
- 支撑/阻力位确认

## 下一步行动

1. **立即执行**：运行诊断模式，查看前10次边沿触发的详细数据
2. **基于数据决策**：根据实际数值调整参数
3. **A/B测试**：同时测试保守和激进两套参数
4. **记录结果**：建立参数-性能数据库，便于后续优化

